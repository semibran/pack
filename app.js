"use strict";!function(){var e=function e(t,s){if(s||(s={size:[0,0],boxes:[]}),!t.length)return s;for(var n={score:1/0,layout:null},l=[[0,0]],r=0;r<s.boxes.length;r++){var a=s.boxes[r];l.push([0,a.position[1]+a.size[1]],[a.position[0]+a.size[0],0]),a.position[0]&&l.push([a.position[0],a.position[1]+a.size[1]]),a.position[1]&&l.push([a.position[0]+a.size[0],a.position[1]])}for(r=0;r<t.length;r++){for(var u=t[r],c=!0,f=0;f<r;f++)if(u[0]===t[f][0]&&u[1]===t[f][1]){c=!1;break}if(c){var p=t.length-1;if(p){var h=new Array(p);for(f=0;f<p;f++)h[f]=f<r?t[f]:t[f+1]}for(f=0;f<l.length;f++){var v=o(s,a={size:u,position:l[f]});if(i(v)){for(var d=p?e(h,v):v,y=d.size[0]*d.size[1],z=0;z<d.boxes.length;z++){y-=(a=d.boxes[z]).size[0]*a.size[1]}y<n.score&&(n.score=y,n.layout=d)}}}}return n.layout};function o(e,o){var i=e.size.slice(),t=e.boxes.slice();return o.position[0]+o.size[0]>i[0]&&(i[0]=o.position[0]+o.size[0]),o.position[1]+o.size[1]>i[1]&&(i[1]=o.position[1]+o.size[1]),t.push(o),{size:i,boxes:t}}function i(e){for(var o=0;o<e.boxes.length-1;o++)for(var i=e.boxes[o],t=o+1;t<e.boxes.length;t++){var s=e.boxes[t];if(l=s,(n=i).position[0]<l.position[0]+l.size[0]&&n.position[0]+n.size[0]>l.position[0]&&n.position[1]<l.position[1]+l.size[1]&&n.position[1]+n.size[1]>l.position[1])return!1}var n,l;return!0}var t=16,s=["red","lime","yellow","blue","fuchsia","aqua","silver"],n={red:"maroon",lime:"green",yellow:"olive",blue:"navy",fuchsia:"purple",aqua:"teal",silver:"gray"},l=function(e,o){o||(o=document.createElement("canvas"));var i=o.getContext("2d"),l=e.cursor,r=e.layout;o.width=r.size[0]*t+1,o.height=r.size[1]*t+1,i.fillStyle="white",i.fillRect(0,0,o.width,o.height);for(var a=0;a<r.size[1];a++)for(var u=0;u<r.size[0];u++)i.beginPath(),i.strokeStyle="silver",i.lineWidth=1,i.strokeRect(u*t+.5,a*t+.5,t,t);for(var c=0;c<r.boxes.length;c++){var f=r.boxes[c],p=n[s[c%s.length]],h=(u=f.position[0],a=f.position[1],f.size[0]),v=f.size[1];i.beginPath(),i.rect(u*t+2,a*t+2,h*t-3,v*t-3),i.strokeStyle=p,i.lineWidth=2,i.stroke(),i.fillStyle=p,i.globalAlpha=.5,i.fill(),i.globalAlpha=1}if(l.selection){p=s[r.boxes.length%s.length],u=l.selection[0],a=l.selection[1],h=l.position[0]-u,v=l.position[1]-a;h<0&&(u+=h,h=-h),v<0&&(a+=v,v=-v),i.beginPath(),i.rect(u*t+2,a*t+2,h*t-3,v*t-3),i.strokeStyle=p,i.lineWidth=2,i.stroke(),i.fillStyle=p,i.globalAlpha=.25,i.fill(),i.globalAlpha=1}return o},r={cursor:{position:null,selection:null},layout:{size:[16,16],boxes:[]}},a={cursor:{move:function(e,o){var i=e.cursor,t=e.layout;o[0]<0&&(o[0]=0),o[1]<0&&(o[1]=0),o[0]>t.size[0]&&(o[0]=t.size[0]),o[1]>t.size[1]&&(o[1]=t.size[1]),i.position=o},select:function(e){e.cursor.selection=e.cursor.position.slice()},deselect:function(e){var o=e.cursor,i=e.layout;if(o.selection){var t=o.selection.slice(),s=o.position,n=s[0]-t[0],l=s[1]-t[1];n&&l&&(n<0&&(n=-n,t[0]-=n),l<0&&(l=-l,t[1]-=l),i.boxes.push({size:[n,l],position:t})),o.selection=null}}},layout:{pack:function(o){var i=o.layout.boxes.map(function(e){return e.size});if(i.length<=6)o.layout=e(i);else{for(var t=null,s=0;s<i.length;s+=4){var n=i.slice(s,s+4);t=e(n,t)}o.layout=t}},reset:function(e){e.layout={size:[16,16],boxes:[]}},randomize:function(o){for(var i=new Array(6),t=6;t--;)i[t]=[Math.floor(7*Math.random())+1,Math.floor(7*Math.random())+1];console.log(i),o.layout=e(i),console.log(o.layout)}}},u=l(r);document.body.style.background="whitesmoke",document.body.appendChild(u);var c=u.getBoundingClientRect();window.addEventListener("mousemove",function(e){a.cursor.move(r,[Math.floor((e.pageX-c.left)/16+.5),Math.floor((e.pageY-c.top)/16+.5)]),l(r,u)}),window.addEventListener("mousedown",function(e){a.cursor.select(r),l(r,u)}),window.addEventListener("mouseup",function(e){a.cursor.deselect(r),l(r,u)}),window.addEventListener("keyup",function(e){"KeyP"===e.code?(a.layout.pack(r),l(r,u)):"KeyN"===e.code?(a.layout.reset(r),l(r,u)):"KeyR"===e.code&&(a.layout.randomize(r),l(r,u))})}();
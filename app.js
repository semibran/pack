"use strict";var app=function(){function e(e){for(var o=0;o<e.boxes.length-1;o++)for(var i=e.boxes[o],s=o+1;s<e.boxes.length;s++){var t=e.boxes[s];if(l=t,(n=i).position[0]<l.position[0]+l.size[0]&&n.position[0]+n.size[0]>l.position[0]&&n.position[1]<l.position[1]+l.size[1]&&n.position[1]+n.size[1]>l.position[1])return!1}var n,l;return!0}var o=16,i=["red","lime","yellow","blue","fuchsia","aqua"],s={red:"maroon",lime:"green",yellow:"olive",blue:"navy",fuchsia:"purple",aqua:"teal"},t=function(e,t){t||(t=document.createElement("canvas"));var n=t.getContext("2d"),l=e.cursor,r=e.layout;t.width=r.size[0]*o+1,t.height=r.size[1]*o+1,n.fillStyle="white",n.fillRect(0,0,t.width,t.height);for(var a=0;a<r.size[1];a++)for(var c=0;c<r.size[0];c++)n.beginPath(),n.strokeStyle="silver",n.lineWidth=1,n.strokeRect(c*o+.5,a*o+.5,o,o);for(var u=0;u<r.boxes.length;u++){var p=r.boxes[u],f=s[i[u%i.length]],h=(c=p.position[0],a=p.position[1],p.size[0]),z=p.size[1];n.beginPath(),n.rect(c*o+2,a*o+2,h*o-3,z*o-3),n.strokeStyle=f,n.lineWidth=2,n.stroke(),n.fillStyle=f,n.globalAlpha=.5,n.fill(),n.globalAlpha=1}if(l.selection)if(l.selection[0]===r.size[0]&&l.selection[1]===r.size[1])n.beginPath(),n.arc(r.size[0]*o,r.size[1]*o,8,0,2*Math.PI),n.strokeStyle="silver",n.lineWidth=1,n.stroke();else{f=i[r.boxes.length%i.length],c=l.selection[0],a=l.selection[1],h=l.position[0]-c,z=l.position[1]-a;h<0&&(c+=h,h=-h),z<0&&(a+=z,z=-z),n.beginPath(),n.rect(c*o+2,a*o+2,h*o-3,z*o-3),n.strokeStyle=f,n.lineWidth=2,n.stroke(),n.fillStyle=f,n.globalAlpha=.25,n.fill(),n.globalAlpha=1}return t},n={cursor:{position:null,selection:null},layout:{size:[16,16],boxes:[]}},l={cursor:{move:function(e,o){var i=e.cursor,s=e.layout;i.selection&&i.selection[0]===s.size[0]&&i.selection[1]===s.size[1]?(s.size[0]=i.position[0],s.size[1]=i.position[1],i.selection[0]=i.position[0],i.selection[1]=i.position[1]):(o[0]<0&&(o[0]=0),o[1]<0&&(o[1]=0),o[0]>s.size[0]&&(o[0]=s.size[0]),o[1]>s.size[1]&&(o[1]=s.size[1])),i.position=o},select:function(e){e.cursor.selection=e.cursor.position.slice()},deselect:function(e){var o=e.cursor,i=e.layout,s=o.selection.slice(),t=o.position,n=t[0]-s[0],l=t[1]-s[1];n&&l&&(n<0&&(n=-n,s[0]-=n),l<0&&(l=-l,s[1]-=l),i.boxes.push({size:[n,l],position:s})),o.selection=null}},layout:{pack:function(o){var i=o.layout.boxes.map(function(e){return e.size}),s=performance.now();o.layout=function o(i,s){if(s||(s={size:[0,0],boxes:[]}),!i.length)return s;for(var t={score:1/0,layout:null},n=[[0,0]],l=0;l<s.boxes.length;l++){var r=s.boxes[l];n.push([0,r.position[1]+r.size[1]],[r.position[0]+r.size[0],0]),r.position[0]&&n.push([r.position[0],r.position[1]+r.size[1]]),r.position[1]&&n.push([r.position[0]+r.size[0],r.position[1]])}for(l=0;l<i.length;l++){for(var a=i[l],c=!0,u=0;u<l;u++)if(a[0]===i[u][0]&&a[1]===i[u][1]){c=!1;break}if(c){var p=i.length-1;if(p){var f=new Array(p);for(u=0;u<p;u++)f[u]=u<l?i[u]:i[u+1]}for(u=0;u<n.length;u++){var h=(b=s,g=r={size:a,position:n[u]},y=void 0,x=void 0,y=b.size.slice(),x=b.boxes.slice(),g.position[0]+g.size[0]>y[0]&&(y[0]=g.position[0]+g.size[0]),g.position[1]+g.size[1]>y[1]&&(y[1]=g.position[1]+g.size[1]),x.push(g),{size:y,boxes:x});if(e(h)){for(var z=p?o(f,h):h,v=z.size[0]*z.size[1],d=0;d<z.boxes.length;d++)v-=(r=z.boxes[d]).size[0]*r.size[1];v<t.score&&(t.score=v,t.layout=z)}}}}var b,g,y,x;return t.layout}(i),console.log(performance.now()-s)}}},r=t(n);document.body.style.background="black",document.body.appendChild(r);var a=r.getBoundingClientRect();window.addEventListener("mousemove",function(e){l.cursor.move(n,[Math.floor((e.pageX-a.left)/16+.5),Math.floor((e.pageY-a.top)/16+.5)]),t(n,r)}),window.addEventListener("mousedown",function(e){l.cursor.select(n),t(n,r)}),window.addEventListener("mouseup",function(e){l.cursor.deselect(n),t(n,r)}),window.addEventListener("keyup",function(e){"Space"===e.code&&(l.layout.pack(n),t(n,r))});return{}}();
//# sourceMappingURL=app.js.map
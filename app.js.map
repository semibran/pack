{"version":3,"sources":["../lib/index.js","../src/render.js","../src/app.js"],"names":["validate","layout","i","boxes","length","a","j","b","position","size","scale","colors","darker","red","lime","yellow","blue","fuchsia","aqua","render","state","canvas","document","createElement","context","getContext","cursor","width","height","fillStyle","fillRect","y","x","beginPath","strokeStyle","lineWidth","strokeRect","box","color","rect","stroke","globalAlpha","fill","selection","arc","Math","PI","app","move","select","slice","deselect","origin","target","push","pack","sizes","map","time","performance","now","best","score","Infinity","positions","unique","remaining","permutation","Array","next","last","k","console","log","body","style","background","appendChild","getBoundingClientRect","window","addEventListener","event","code"],"mappings":"gCAgEE,SAASA,EAAQC,GACf,IAAK,IAAGC,EAAA,EAAOA,EAAKD,EAAGE,MAAAC,OAAA,EAAAF,IAErB,IADF,IAAKG,EAAKJ,EAAOE,MAAID,GACXI,EAAAJ,EAAO,EAAKI,EAAGL,EAAAE,MAAAC,OAAAE,IAAA,CACvB,IAAIC,EAAAN,EAAYE,MAAMG,GACpB,GAQiBC,EARLA,GAQEF,EARFA,GASTG,SAAW,GAAKD,EAAAC,SAAW,GAAKD,EAAAE,KAAO,IAAMJ,EAAAG,SAAW,GAAKH,EAAAI,KAAO,GAAKF,EAAAC,SAAW,IAAAH,EAAAG,SAAA,GAAAD,EAAAC,SAAA,GAAAD,EAAAE,KAAA,IAAAJ,EAAAG,SAAA,GAAAH,EAAAI,KAAA,GAAAF,EAAAC,SAAA,GARxF,OAAA,EAOL,IAAoBH,EAAGE,EAHxB,OAAA,EC1ED,IAAIG,EAAQ,GACRC,GAAW,MAAO,OAAQ,SAAU,OAAQ,UAAW,QACvDC,GAAWC,IAAK,SAAUC,KAAM,QAASC,OAAQ,QAASC,KAAM,OAAQC,QAAS,SAAUC,KAAM,QAErGC,EAAiB,SAAgBC,EAAOC,GACjCA,IAAQA,EAASC,SAASC,cAAc,WAC7C,IAAIC,EAAUH,EAAOI,WAAW,MAC5BC,EAASN,EAAMM,OACfzB,EAASmB,EAAMnB,OACnBoB,EAAOM,MAAQ1B,EAAOQ,KAAO,GAAGC,EAAS,EACzCW,EAAOO,OAAS3B,EAAOQ,KAAO,GAAGC,EAAS,EAC1Cc,EAAQK,UAAY,QACpBL,EAAQM,SAAU,EAAG,EAAET,EAAOM,MAAON,EAAOO,QAC5C,IAAK,IAAKG,EAAI,EAAGA,EAAG9B,EAAOQ,KAAO,GAAGsB,IACnC,IAAK,IAAKC,EAAI,EAAGA,EAAG/B,EAAOQ,KAAO,GAAGuB,IACnCR,EAAQS,YACRT,EAAQU,YAAc,SACtBV,EAAQW,UAAa,EACrBX,EAAQY,WAAYJ,EAAGtB,EAAQ,GAAMqB,EAAGrB,EAAQ,GAAKA,EAAOA,GAGhE,IAAK,IAAKR,EAAI,EAAGA,EAAGD,EAAOE,MAAMC,OAASF,IAAI,CAC5C,IAAImC,EAAMpC,EAAOE,MAAOD,GACpBoC,EAAQ1B,EAAOD,EAAQT,EAAGS,EAAOP,SAGjCuB,GAFCK,EAAGK,EAAI7B,SAAU,GACjBuB,EAAGM,EAAI7B,SAAU,GACV6B,EAAI5B,KAAM,IAClBmB,EAASS,EAAI5B,KAAM,GACvBe,EAAQS,YACRT,EAAQe,KAAMP,EAAGtB,EAAS,EAAGqB,EAAGrB,EAAS,EAAEiB,EAAQjB,EAAS,EAAEkB,EAASlB,EAAS,GAChFc,EAAQU,YAAcI,EACtBd,EAAQW,UAAa,EACrBX,EAAQgB,SACRhB,EAAQK,UAAYS,EACpBd,EAAQiB,YAAc,GACtBjB,EAAQkB,OACRlB,EAAQiB,YAAe,EAEzB,GAAIf,EAAOiB,UACT,GAAIjB,EAAOiB,UAAY,KAAK1C,EAAOQ,KAAO,IAAIiB,EAAOiB,UAAY,KAAK1C,EAAOQ,KAAO,GAClFe,EAAQS,YACRT,EAAQoB,IAAI3C,EAAOQ,KAAO,GAAGC,EAAOT,EAAOQ,KAAO,GAAGC,EAAQ,EAAG,EAAG,EAAGmC,KAAOC,IAC7EtB,EAAQU,YAAc,SACtBV,EAAQW,UAAa,EACrBX,EAAQgB,aACH,CACDF,EAAQ3B,EAAOV,EAAOE,MAAMC,OAASO,EAAOP,QAC3C4B,EAAGN,EAAOiB,UAAW,GACrBZ,EAAGL,EAAOiB,UAAW,GACtBhB,EAAQD,EAAOlB,SAAW,GAAIwB,EAC9BJ,EAASF,EAAOlB,SAAW,GAAIuB,EAC/BJ,EAAS,IACVK,GAAIL,EACLA,GAASA,GAEPC,EAAU,IACXG,GAAIH,EACLA,GAAUA,GAEZJ,EAAQS,YACRT,EAAQe,KAAMP,EAAGtB,EAAS,EAAGqB,EAAGrB,EAAS,EAAEiB,EAAQjB,EAAS,EAAEkB,EAASlB,EAAS,GAChFc,EAAQU,YAAcI,EACtBd,EAAQW,UAAa,EACrBX,EAAQgB,SACRhB,EAAQK,UAAYS,EACpBd,EAAQiB,YAAc,IACtBjB,EAAQkB,OACRlB,EAAQiB,YAAe,EAG3B,OAAOpB,GCpEH0B,GAEFrB,QACElB,SAAU,KACVmC,UAAW,MAEb1C,QACEQ,MAAQ,GAAI,IACZN,WARA4C,GAYFrB,QACEsB,KAAO,SAAe5B,EAAKZ,GACzB,IAAMkB,EAAQN,EAAMM,OAChBzB,EAAOmB,EAASnB,OAElByB,EAAWiB,WAAajB,EAAAiB,UAAW,KAAA1C,EAAAQ,KAAA,IAAAiB,EAAAiB,UAAA,KAAA1C,EAAAQ,KAAA,IACnCR,EAAOQ,KAAA,GAAYiB,EAAGlB,SAAO,GAC7BP,EAAOQ,KAAA,GAAYiB,EAAGlB,SAAO,GAC9BkB,EAAMiB,UAAA,GAAAjB,EAAAlB,SAAA,GACLkB,EAAIiB,UAAe,GAAEjB,EAAUlB,SAAK,KAEhCA,EAAW,GAAG,IAAAA,EAAc,GAAE,GAC9BA,EAAW,GAAG,IAAAA,EAAc,GAAE,GACnCA,EAAA,GAAAP,EAAAQ,KAAA,KAAAD,EAAA,GAAAP,EAAAQ,KAAA,IACMD,EAAQ,GAAGP,EAAQQ,KAAA,KAAAD,EAAA,GAAAP,EAAAQ,KAAA,KAE5BiB,EAASlB,SAAUA,GAElByC,OAAA,SAAA7B,GACDA,EAAUM,OAAMiB,UAAKvB,EAAAM,OAAAlB,SAAA0C,SAEnBC,SAAU,SAAU/B,GACpB,IAAIM,EAASN,EAAOM,OAChBzB,EAAQmB,EAASnB,OAEjBmD,EAAS1B,EAAQiB,UAAAO,QACfG,EAAS3B,EAAElB,SACbmB,EAAS0B,EAAK,GAAAD,EAAA,GACdxB,EAASyB,EAAI,GAAKD,EAAA,GACnBzB,GAAAC,IACGD,EAAU,IACZA,GAAUA,EACVyB,EAAS,IAAIzB,GAETC,EAAO,IACXA,GAAQA,EACRwB,EAAQ,IAAExB,GAEb3B,EAAAE,MAAAmD,MACK7C,MAACkB,EAAYC,GACpBpB,SAAA4C,KAGG1B,EAAGiB,UAAU,eAIfY,KAAA,SAAYnC,GACb,IAAAoC,EAAApC,EAAAnB,OAAAE,MAAAsD,IAAA,SAAApB,GACF,OAAAA,EAAA5B,OAEJiD,EAAAC,YAAAC,eF/DW,SAASL,EAAAC,EAAOvD,GAE1B,GADIA,IAASA,GAAOQ,MAAU,EAAM,GAAEN,YAClCqD,EAASpD,OAAQ,OAAKH,EAGxB,IAFF,IAAK4D,GAASC,MAAMC,EAAAA,EAAY9D,OAAO,MACjC+D,IAAa,EAAA,IACR9D,EAAC,EAAKA,EAAKD,EAAIE,MAASC,OAAQF,IAAK,CAC9C,IAAImC,EAAIpC,EAAWE,MAAED,GACrB8D,EAAQV,MAAU,EAAGjB,EAAA7B,SAAU,GAAO6B,EAAI5B,KAAA,KAAW4B,EAAG7B,SAAW,GAAK6B,EAAC5B,KAAQ,GAAG,IACrF4B,EAAA7B,SAAA,IAAAwD,EAAAV,MAAAjB,EAAA7B,SAAA,GAAA6B,EAAA7B,SAAA,GAAA6B,EAAA5B,KAAA,KACI4B,EAAK7B,SAAU,IAAKwD,EAAUV,MAAIjB,EAAA7B,SAAA,GAAA6B,EAAA5B,KAAA,GAAA4B,EAAA7B,SAAA,KAErC,IAAIN,EAAS,EAAAA,EAAIsD,EAAApD,OAAAF,IAAA,KACjB,IAAKO,EAAQ+C,EAAItD,GACX+D,GAAO,EACH3D,EAAG,EAAAA,EAAKJ,EAAAI,IACd,GAAAG,EAAK,KAAA+C,EAAAlD,GAAA,IAAAG,EAAA,KAAA+C,EAAAlD,GAAA,GAAA,CACN2D,GAAA,EACF,MAGD,GAAIA,EAAJ,CACE,IAAIC,EAAWV,EAAOpD,OAAM,EAC5B,GAAA8D,EACE,CAAA,IAAIC,EAAO,IAAWC,MAAMF,OACvB5D,EAAA,EAAWA,EAAG4D,EAAU5D,IAC9B6D,EAAA7D,GAAAA,EAAAJ,EAAAsD,EAAAlD,GAAAkD,EAAAlD,EAAA,GAGD,IAAIA,EAAQ,EAAGA,EAAA0D,EAAY5D,OAAAE,IAAA,CAC3B,IAEI+D,GAkBGpE,EAlBaA,EAkBDoC,EAnBfA,GAAO5B,KAAOA,EAAQD,SADVwD,EAAQ1D,IAqBxBG,OAAAA,EACAN,OAAAA,EADAM,EAAQR,EAAOQ,KAAMyC,QACrB/C,EAAIF,EAAWE,MAAO+C,QACpBb,EAAG7B,SAAO,GAAQ6B,EAAG5B,KAAM,GAAKA,EAAG,KACxCA,EAAA,GAAA4B,EAAA7B,SAAA,GAAA6B,EAAA5B,KAAA,IAEK4B,EAAG7B,SAAO,GAAQ6B,EAAG5B,KAAM,GAAKA,EAAG,KACxCA,EAAA,GAAA4B,EAAA7B,SAAA,GAAA6B,EAAA5B,KAAA,IAEDN,EAAOmD,KAAMjB,IACd5B,KAAAA,EAAAN,MAAAA,IA3BO,GAAIH,EAAOqE,GAAS,CAGlB,IAFF,IAAIC,EAAQJ,EAAYX,EAAGY,EAAYE,GAAAA,EAClCP,EAASQ,EAAG7D,KAAO,GAAC6D,EAAM7D,KAAQ,GAC9B8D,EAAG,EAAKA,EAAKD,EAAGnE,MAAAC,OAAAmE,IAExBT,IADMzB,EAAOiC,EAAKnE,MAAMoE,IACxB9D,KAAA,GAAA4B,EAAA5B,KAAA,GAEKqD,EAAMD,EAAGC,QACbD,EAAKC,MAASA,EACfD,EAAA5D,OAAAqE,MAQP,IAAWrE,EAAYoC,EACnB5B,EACAN,EALL,OAAA0D,EAAA5D,WEmBSuE,QAAGC,IAAOd,YAAUC,MAAAF,MAMxBrC,EAAQF,EAAO4B,YACZ2B,KAAOC,MAAMC,WAAa,iBAC1BF,KAAOG,YAAWxD,GAEzB,IAAAkB,EAAWlB,EAAOyD,wBACnBC,OAACC,iBAAA,YAAA,SAAAC,2FAEF9D,EAAO4B,EAAA1B,KAGN0D,OAACC,iBAAA,YAAA,SAAAC,sBAEF9D,EAAO4B,EAAA1B,KAGN0D,OAACC,iBAAA,UAAA,SAAAC,wBAEF9D,EAAO4B,EAAA1B,YAGH2D,iBAAkB,QAAO,SAAAC,GAC1B,UAAAA,EAAAC,OACDnC,EAAA9C,OAAAsD,KAAAR","sourcesContent":["module.exports = function pack(sizes, layout) {\n  if (!layout) layout = { size: [ 0, 0 ], boxes: [] }\n  if (!sizes.length) return layout\n  var best = { score: Infinity, layout: null }\n  var positions = [ [ 0, 0 ] ]\n  for (var i = 0; i < layout.boxes.length; i++) {\n    var box = layout.boxes[i]\n    positions.push([ 0, box.position[1] + box.size[1] ], [ box.position[0] + box.size[0], 0 ])\n    if (box.position[0]) positions.push([ box.position[0], box.position[1] + box.size[1] ])\n    if (box.position[1]) positions.push([ box.position[0] + box.size[0], box.position[1] ])\n  }\n  for (var i = 0; i < sizes.length; i++) {\n    var size = sizes[i]\n    var unique = true\n    for (var j = 0; j < i; j++) {\n      if (size[0] === sizes[j][0] && size[1] === sizes[j][1]) {\n        unique = false\n        break\n      }\n    }\n    if (!unique) continue\n    var remaining = sizes.length - 1\n    if (remaining) {\n      var permutation = new Array(remaining)\n      for (var j = 0; j < remaining; j++) {\n        if (j < i) permutation[j] = sizes[j]\n        else permutation[j] = sizes[j + 1]\n      }\n    }\n    for (var j = 0; j < positions.length; j++) {\n      var position = positions[j]\n      var box = { size: size, position: position }\n      var next = append(layout, box)\n      if (validate(next)) {\n        var last = remaining ? pack(permutation, next) : next\n        var score = last.size[0] * last.size[1]\n        for (var k = 0; k < last.boxes.length; k++) {\n          var box = last.boxes[k]\n          score -= box.size[0] * box.size[1]\n        }\n        if (score < best.score) {\n          best.score = score\n          best.layout = last\n        }\n      }\n    }\n  }\n  return best.layout\n}\n\nfunction append(layout, box) {\n  var size = layout.size.slice()\n  var boxes = layout.boxes.slice()\n  if (box.position[0] + box.size[0] > size[0]) {\n    size[0] = box.position[0] + box.size[0]\n  }\n  if (box.position[1] + box.size[1] > size[1]) {\n    size[1] = box.position[1] + box.size[1]\n  }\n  boxes.push(box)\n  return { size: size, boxes: boxes }\n}\n\nfunction validate(layout) {\n  for (var i = 0; i < layout.boxes.length - 1; i++) {\n    var a = layout.boxes[i]\n    for (var j = i + 1; j < layout.boxes.length; j++) {\n      var b = layout.boxes[j]\n      if (intersects(a, b)) {\n        return false\n      }\n    }\n  }\n  return true\n}\n\nfunction intersects(a, b) {\n  return a.position[0] < b.position[0] + b.size[0] && a.position[0] + a.size[0] > b.position[0]\n      && a.position[1] < b.position[1] + b.size[1] && a.position[1] + a.size[1] > b.position[1]\n}\n","var scale = 16\nvar colors = [ \"red\", \"lime\", \"yellow\", \"blue\", \"fuchsia\", \"aqua\" ]\nvar darker = { red: \"maroon\", lime: \"green\", yellow: \"olive\", blue: \"navy\", fuchsia: \"purple\", aqua: \"teal\" }\n\nmodule.exports = function render(state, canvas) {\n  if (!canvas) canvas = document.createElement(\"canvas\")\n  var context = canvas.getContext(\"2d\")\n  var cursor = state.cursor\n  var layout = state.layout\n  canvas.width = layout.size[0] * scale + 1\n  canvas.height = layout.size[1] * scale + 1\n  context.fillStyle = \"white\"\n  context.fillRect(0, 0, canvas.width, canvas.height)\n  for (var y = 0; y < layout.size[1]; y++) {\n    for (var x = 0; x < layout.size[0]; x++) {\n      context.beginPath()\n      context.strokeStyle = \"silver\"\n      context.lineWidth = 1\n      context.strokeRect(x * scale + 0.5, y * scale + 0.5, scale, scale)\n    }\n  }\n  for (var i = 0; i < layout.boxes.length; i++) {\n    var box = layout.boxes[i]\n    var color = darker[colors[i % colors.length]]\n    var x = box.position[0]\n    var y = box.position[1]\n    var width = box.size[0]\n    var height = box.size[1]\n    context.beginPath()\n    context.rect(x * scale + 2, y * scale + 2, width * scale - 3, height * scale - 3)\n    context.strokeStyle = color\n    context.lineWidth = 2\n    context.stroke()\n    context.fillStyle = color\n    context.globalAlpha = 0.5\n    context.fill()\n    context.globalAlpha = 1\n  }\n  if (cursor.selection) {\n    if (cursor.selection[0] === layout.size[0] && cursor.selection[1] === layout.size[1]) {\n      context.beginPath()\n      context.arc(layout.size[0] * scale, layout.size[1] * scale, 8, 0, 2 * Math.PI)\n      context.strokeStyle = \"silver\"\n      context.lineWidth = 1\n      context.stroke()\n    } else {\n      var color = colors[layout.boxes.length % colors.length]\n      var x = cursor.selection[0]\n      var y = cursor.selection[1]\n      var width = cursor.position[0] - x\n      var height = cursor.position[1] - y\n      if (width < 0) {\n        x += width\n        width = -width\n      }\n      if (height < 0) {\n        y += height\n        height = -height\n      }\n      context.beginPath()\n      context.rect(x * scale + 2, y * scale + 2, width * scale - 3, height * scale - 3)\n      context.strokeStyle = color\n      context.lineWidth = 2\n      context.stroke()\n      context.fillStyle = color\n      context.globalAlpha = 0.25\n      context.fill()\n      context.globalAlpha = 1\n  }\n  }\n  return canvas\n}\n","const pack = require(\"../lib\")\nconst render = require(\"./render\")\nconst app = {\n  state: {\n    cursor: {\n      position: null,\n      selection: null\n    },\n    layout: {\n      size: [ 16, 16 ],\n      boxes: []\n    }\n  },\n  actions: {\n    cursor: {\n      move: (state, position) => {\n        let { cursor, layout } = state\n        if (cursor.selection && cursor.selection[0] === layout.size[0] && cursor.selection[1] === layout.size[1]) {\n          layout.size[0] = cursor.position[0]\n          layout.size[1] = cursor.position[1]\n          cursor.selection[0] = cursor.position[0]\n          cursor.selection[1] = cursor.position[1]\n        } else {\n          if (position[0] < 0) position[0] = 0\n          if (position[1] < 0) position[1] = 0\n          if (position[0] > layout.size[0]) position[0] = layout.size[0]\n          if (position[1] > layout.size[1]) position[1] = layout.size[1]\n        }\n        cursor.position = position\n      },\n      select: (state) => {\n        state.cursor.selection = state.cursor.position.slice()\n      },\n      deselect: (state) => {\n        let { cursor, layout } = state\n        let origin = cursor.selection.slice()\n        let target = cursor.position\n        let width = target[0] - origin[0]\n        let height = target[1] - origin[1]\n        if (width && height) {\n          if (width < 0) {\n            width = -width\n            origin[0] -= width\n          }\n          if (height < 0) {\n            height = -height\n            origin[1] -= height\n          }\n          layout.boxes.push({\n            size: [ width, height ],\n            position: origin\n          })\n        }\n        cursor.selection = null\n      }\n    },\n    layout: {\n      pack: (state) => {\n        let sizes = state.layout.boxes.map(box => box.size)\n        let time = performance.now()\n        state.layout = pack(sizes)\n        console.log(performance.now() - time)\n      }\n    }\n  }\n}\n\nlet canvas = render(app.state)\ndocument.body.style.background = \"black\"\ndocument.body.appendChild(canvas)\n\nlet rect = canvas.getBoundingClientRect()\nwindow.addEventListener(\"mousemove\", event => {\n  app.actions.cursor.move(app.state, [\n    Math.floor((event.pageX - rect.left) / 16 + 0.5),\n    Math.floor((event.pageY - rect.top) / 16 + 0.5)\n  ])\n  render(app.state, canvas)\n})\n\nwindow.addEventListener(\"mousedown\", event => {\n  app.actions.cursor.select(app.state)\n  render(app.state, canvas)\n})\n\nwindow.addEventListener(\"mouseup\", event => {\n  app.actions.cursor.deselect(app.state)\n  render(app.state, canvas)\n})\n\nwindow.addEventListener(\"keyup\", event => {\n  if (event.code === \"Space\") {\n    app.actions.layout.pack(app.state)\n    render(app.state, canvas)\n  }\n})\n"]}